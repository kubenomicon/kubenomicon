<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Kubeconfig file - The Kubenomicon</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="./Kubenomicon.html">Home - Kubenomicon</a></li><li><a href="Initial_access.html"><strong>1.</strong> Initial access</a></li><li><ul class="section"><li><a href="Initial_access/Using_cloud_credentials.html"><strong>1.1.</strong> Using cloud credentials</a></li><li><a href="Initial_access/Compromised_image_in_registry.html"><strong>1.2.</strong> Compromised image In registry</a></li><li><a href="Initial_access/Kubeconfig_file.html" class="active"><strong>1.3.</strong> Kubeconfig file</a></li><li><a href="Initial_access/Application_vulnerability.html"><strong>1.4.</strong> Application vulnerability</a></li><li><a href="Initial_access/Exposed_sensitive_interfaces.html"><strong>1.5.</strong> Exposed sensitive interfaces</a></li><li><a href="./Initial_access/SSH_server_running_inside_container.html"><strong>1.6.</strong> SSH server running inside container</a></li></ul></li><li><a href="Execution.html"><strong>2.</strong> Execution</a></li><li><ul class="section"><li><a href="Execution/Exec_inside_container.html"><strong>2.1.</strong> Exec inside container</a></li><li><a href="Execution/New_container.html"><strong>2.2.</strong> New container</a></li><li><a href="./Execution/Application_exploit.html"><strong>2.3.</strong> Application exploit (RCE) üîó</a></li><li><a href="Execution/Sidecar_injection.html"><strong>2.4.</strong> Sidecar injection</a></li></ul></li><li><a href="Persistence.html"><strong>3.</strong> Persistence</a></li><li><ul class="section"><li><a href="Persistence/Backdoor_container.html"><strong>3.1.</strong> Backdoor container</a></li><li><a href="Persistence/Writable_hostPath_mount.html"><strong>3.2.</strong> Writable hostPath mount</a></li><li><a href="Persistence/Kubernetes_cronjob.html"><strong>3.3.</strong> Kubernetes cronjob</a></li><li><a href="Persistence/Malicious_admission_controller.html"><strong>3.4.</strong> Malicious admission controller</a></li><li><a href="Persistence/Container_service_account.html"><strong>3.5.</strong> Container service account üîó</a></li><li><a href="Persistence/Static_pods.html"><strong>3.6.</strong> Static pods</a></li></ul></li><li><a href="Privilege_escalation.html"><strong>4.</strong> Privilege escalation</a></li><li><ul class="section"><li><a href="Privilege_escalation/Privileged_container.html"><strong>4.1.</strong> Privileged container</a></li><li><a href="Privilege_escalation/Cluster-admin_binding.html"><strong>4.2.</strong> Cluster-admin binding</a></li><li><a href="Privilege_escalation/hostPath_mount.html"><strong>4.3.</strong> hostPath mount üîó</a></li><li><a href="Privilege_escalation/Access_cloud_resources.html"><strong>4.4.</strong> Access cloud resources üîó</a></li></ul></li><li><a href="Defense_evasion.html"><strong>5.</strong> Defense evasion</a></li><li><ul class="section"><li><a href="Defense_evasion/Clear_container_logs.html"><strong>5.1.</strong> Clear container logs</a></li><li><a href="Defense_evasion/Delete_events.html"><strong>5.2.</strong> Delete events</a></li><li><a href="Defense_evasion/Pod_name_similarity.html"><strong>5.3.</strong> Pod name similarity</a></li><li><a href="Defense_evasion/Connect_from_proxy_server.html"><strong>5.4.</strong> Connect from proxy server</a></li></ul></li><li><a href="Credential_access.html"><strong>6.</strong> Credential access</a></li><li><ul class="section"><li><a href="Credential_access/List_K8S_secrets.html"><strong>6.1.</strong> List K8S secrets</a></li><li><a href="Credential_access/Access_node_information.html"><strong>6.2.</strong> Access node information</a></li><li><a href="Credential_access/Container_service_account.html"><strong>6.3.</strong> Container service account</a></li><li><a href="Credential_access/Application_credentials_in_configuration_files.html"><strong>6.4.</strong> Application credentials in configuration files</a></li><li><a href="Credential_access/Access_managed_identity_credentials.html"><strong>6.5.</strong> Access managed identity credentials</a></li><li><a href="Credential_access/Malicious_admission_controller.html"><strong>6.6.</strong> Malicious admission controller üîó</a></li></ul></li><li><a href="Discovery.html"><strong>7.</strong> Discovery</a></li><li><ul class="section"><li><a href="Discovery/Access_kubernetes_API_server.html"><strong>7.1.</strong> Access Kubernetes API server</a></li><li><a href="Discovery/Access_kubelet_API.html"><strong>7.2.</strong> Access Kubelet API</a></li><li><a href="Discovery/Network_mapping.html"><strong>7.3.</strong> Network mapping</a></li><li><a href="Discovery/Exposed_sensitive_interfaces.html"><strong>7.4.</strong> Exposed sensitive interfaces üîó</a></li><li><a href="Discovery/Instance_metadata_API.html"><strong>7.5.</strong> Instance Metadata API üîó</a></li></ul></li><li><a href="Lateral_movement.html"><strong>8.</strong> Lateral movement</a></li><li><ul class="section"><li><a href="Lateral_movement/Access_cloud_resources.html"><strong>8.1.</strong> Access cloud resources üîó</a></li><li><a href="Lateral_movement/Container_service_account.html"><strong>8.2.</strong> Container service account üîó</a></li><li><a href="Lateral_movement/Cluster_internal_networking.html"><strong>8.3.</strong> Cluster internal networking</a></li><li><a href="Lateral_movement/Application_credentials_in_configuration_files.html"><strong>8.4.</strong> Application credentials in configuration files üîó</a></li><li><a href="Lateral_movement/Writable_hostPath_mount.html"><strong>8.5.</strong> Writable hostPath mount üîó</a></li><li><a href="Lateral_movement/CoreDNS_poisoning.html"><strong>8.6.</strong> CoreDNS poisoning</a></li><li><a href="Lateral_movement/ARP_poisoning_and_IP_spoofing.html"><strong>8.7.</strong> ARP poisoning and IP spoofing</a></li></ul></li><li><a href="Collection.html"><strong>9.</strong> Collection</a></li><li><ul class="section"><li><a href="Collection/Images_from_a_private_registry.html"><strong>9.1.</strong> Images from a private registry</a></li><li><a href="Collection/Collecting_data_from_pod.html"><strong>9.2.</strong> Collecting data from pod</a></li></ul></li><li><a href="Impact.html"><strong>10.</strong> Impact</a></li><li><ul class="section"><li><a href="Impact/Data_destruction.html"><strong>10.1.</strong> Data destruction</a></li><li><a href="Impact/Resource_hijacking.html"><strong>10.2.</strong> Resource hijacking</a></li><li><a href="Impact/Denial_of_service.html"><strong>10.3.</strong> Denial of service</a></li></ul></li><li><a href="./Fundamentals.html"><strong>11.</strong> Fundamentals</a></li><li><ul class="section"><li><a href="./Fundamentals/Nodes.html"><strong>11.1.</strong> Nodes</a></li><li><a href="./Fundamentals/Services.html"><strong>11.2.</strong> Services</a></li><li><a href="./Fundamentals/etcd.html"><strong>11.3.</strong> etcd</a></li><li><a href="./Fundamentals/RBAC.html"><strong>11.4.</strong> RBAC</a></li><li><a href="./Fundamentals/Kubelet.html"><strong>11.5.</strong> Kubelet</a></li><li><a href="./Fundamentals/Namespaces.html"><strong>11.6.</strong> Namespaces</a></li><li><a href="./Fundamentals/Secrets.html"><strong>11.7.</strong> Secrets</a></li><li><a href="./Fundamentals/Interesting_files.html"><strong>11.8.</strong> Interesting Files</a></li></ul></li><li><a href="./Contributing.html">Contributing</a></li><li class="affix"><a href="Pentesting%20Kubernetes.html">Pentesting Kubernetes</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">The Kubenomicon</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="Initial_access/Kubeconfig_file.html#kubeconfig-file" id="kubeconfig-file"><h1>Kubeconfig file</h1></a>
<p>The Kubeconfig file is a configuration file that contains all the information <code>kubectl</code> needs to access the cluster. This includes information such as where the API server is, which credentials to use to interact with it, default namespaces, etc. You can change which Kubeconfig file you're using by setting the <code>$KUBECONFIG</code> environment variable.</p>
<p>Should an attacker gain access to a Kubeconfig file, they can instruct Kubectl to use it to access the cluster. <code>export KUBECONFIG=/path/to/kubeconfig</code>. Note that this file is typically just called <code>config</code> and stored in <code>~/.kube/config</code> but these can be left in many different places so it's worth hunting for them.</p>
<p><img src="../images/2024-03-20_23-46.png" alt="" /></p>
<p>The following is an example of what a Kubeconfig YAML file looks like:</p>
<pre><code class="language-yaml">apiVersion: v1
# Holds information on how to access the cluster
clusters:
  - cluster:
  # The API server's public key. Does not need to be kept secret
      certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCakNDQWU2Z0F3SUJBZ0lCQVRBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwdGFXNXAKYTNWaVpVTkJNQjRYRFRJek1EY3lOREU0TXpJMU1Gb1hEVE16TURjeU1qRTRNekkxTUZvd0ZURVRNQkVHQTFVRQpBeE1LYldsdWFXdDFZbVZEUVRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTUFECitnZDVoUEk5VmorNFk3Q25ZcDRDTnZBVkpGNGE5eWVrYUhkbWJaN0Mzby8zZ0xNT29CWDFEdktMbFh0WVFxaXcKUEpuYk1LMFJFNGI2QzM5K3laN3V4aTdNZGllc2xHYmdPRitLNnMvb2xBOExHdnk4R3V6Zmk3T1RlaFRacFF6VAoraGFzaFlLNFRJYU5KNGtTOUN0dFd6VzJVa243cHNxNWpFa0l0eFpGdnpWblhwYVNPQVZVOEJRSm1rMzhQUXIxCm5nVzdJbkdiNFNQcGZOWVlrVURUOEVzWG10eElJdWU5ZmJ2aThPM0E1eTNFSVB0ZkJDdk45M3paUFRIK0RyVTkKRUduYkhqWlVlQ3hGa1E1QmtMMjVjcTh2UVoyZWhtb3d6a1Z1dVM3SGUyZTFUOHNuc01uanpwaGtoV2NMMDRiWApPTHhmYy8wRER0VVJEV0pYdnRNQ0F3RUFBYU5oTUY4d0RnWURWUjBQQVFIL0JBUURBZ0trTUIwR0ExVWRKUVFXCk1CUUdDQ3NHQVFVRkJ3TUNCZ2dyQmdFRkJRY0RBVEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQjBHQTFVZERnUVcKQkJTTDQyYkEydVdsWnVzSHFOYUdqd0RwM21CRHNqQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFDVEZjc2FaaAp4bjVNZTI2bkN1VVNjSDEzbFhKSjFSOXJPLzNXRDE0cUZrMERET2ZMVkZBdkR1L0xWU2ZIVkF5N0dSYWJCOWNUCmVXNndDV3JhUy9aczFDYXVMOG8vTVdoWG9VWUtHc0IxNVE0R21VUzBLMXV4L2ZNUUlZczVUNUJmU0UrLzBsQ0EKL2hINWRVaDMraklSa1ZhVVZBbDFxL3VQR0dIRXlqWGNMdlp5TGVmSENTMlJWbFU5SS9xb2FkQTd2ZE5US3VTNwpYOUZhZjdNNUxMYXRzNldraWRXd3BrS3FDQ3Z2YlhNck85SmFobXhrbFZvamhYYUZTQkNuSWpaQUIzQ2JTSWNBClpRWFNBTVlaTWZBSUNEYTF3eW1jM1dXUUZQVlZ0NUpubHd3WWx3TlVpTk9GdUJqZUtMMTUvSDZyS3VRdktHbkcKMmdVRUphUFV4WS93U0E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      # API Server Address
      server: https://192.168.59.101:8443
    name: dev-cluster
  - cluster:
      certificate-authority: /home/smores/.minikube/ca.crt
      extensions:
        - extension:
            last-update: Mon, 18 Mar 2024 14:44:21 EDT
            provider: minikube.sigs.k8s.io
            version: v1.30.1
          name: cluster_info
      server: https://192.168.49.2:8443
    name: minikube
# Which Cluster, user, and namespace to access by default
contexts:
  - context:
      cluster: minikube
      extensions:
        - extension:
            last-update: Mon, 18 Mar 2024 14:44:21 EDT
            provider: minikube.sigs.k8s.io
            version: v1.30.1
          name: context_info
      namespace: default
      user: minikube
    name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
  # Which user to authenticate to the cluster as
  - name: minikube
    user:
    # Contains a cert for the user signed by the kubernetes CA. This IS sensitive. Sometimes a token is used instead (such as service accounts)
      client-certificate: /home/smores/.minikube/profiles/minikube/client.crt
      client-key: /home/smores/.minikube/profiles/minikube/client.key

</code></pre>
<p>You can utilize <a href="https://github.com/grahamhelton/dredge">Dredge</a> to search for Kubeconfig files.</p>
<p><img src="../images/Pasted%20image%2020240328224853.png" alt="" /></p>
<a class="header" href="Initial_access/Kubeconfig_file.html#switching-contexts" id="switching-contexts"><h1>Switching Contexts</h1></a>
<p>Kubeconfig files allow you to set multiple &quot;contexts&quot;. Each context may have different RBAC permissions. In the following example, the <code>admin</code> user has full admin permissions as denoted by the <code>kubectl auth can-i --list | head</code> command displaying all RBAC verbs for all resources (piped to head for brevity).</p>
<p>Upon switching to the <code>dev</code> context using <code>kubectl config use-context dev</code>, and re-running <code>kubectl auth can-i --list | head</code>, the RBAC permissions for the dev context are displayed which are far less permissive.
<img src="../images/Pasted%20image%2020240321123344.png" alt="" /></p>
<a class="header" href="Initial_access/Kubeconfig_file.html#defending" id="defending"><h1>Defending</h1></a>
<blockquote>
<p>Pull requests needed ‚ù§Ô∏è </p>
</blockquote>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="Initial_access/Compromised_image_in_registry.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="Initial_access/Application_vulnerability.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="Initial_access/Compromised_image_in_registry.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="Initial_access/Application_vulnerability.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
