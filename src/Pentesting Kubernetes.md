# 4 layers of Kubernetes security
Kubernetes is a multifaceted system and the complexity of a cluster is greater than the sum of it's relatively simple core components. My biggest mistake when first trying to "hack Kubernetes" was looking at the a cluster holistically instead of atomistically. It helps to focus on one core component of a Kubernetes cluster at a time. There are four main layers of Kubernetes security (sometimes referred to as the 4C's of cloud native security). 
1. **Code Security**: Is the code deployed into a pod secure? Is it vulnerable to SQL injection, command injection, or any other type of vulnerabilities in the [OWASP Top 10](https://owasp.org/www-project-top-ten/)?
2. **Container Security**: Is the container you're launching hosting your application trusted? Where did you get the image from? Is the container running as root? 
3. **Cluster Security**: Is your cluster configured with the [principles of least privilege](https://www.cyberark.com/what-is/least-privilege/) in mind? Is RBAC in use? Are secrets being stored appropriately?
4. **Cloud Security**: Is the infrastructure hosting the cluster secure? Have the nodes been patched? Are they running SSH with a default password? Is access to the API server restricted? 

> Note: I much prefer the term *infrastructure security* instead of *cloud security* since you can run a Kubernetes cluster in a non-cloud environment but I will stick with *cloud security*  to avoid confusion.
# Offensive Kubernetes Tooling
- [Trivy](https://github.com/aquasecurity/trivy): An extremely comprehensive tool that allows for finding vulnerabilities at multiple different "layers" of Kubernetes security depending on how it's run.
- **[Peirates](https://github.com/inguardians/peirates)**: A swiss army knife of Kubernetes pentesting.
- **[Kdigger](https://github.com/quarkslab/kdigger)**: A context discovery tool for offensive security assessments.

# Helpful Commands

- Install kubectl oneliner: `curl -LO https://dl.k8s.io/release/v1.29.2/bin/linux/amd64/kubectl && chmod +x kubectl && mv ./kubectl /usr/bin/ ; kubectl version`

# Enumeration
`kubectl cluster-info` can be used to display various information about the cluster

You can get a VERY verbose dump of this information with `kubectl cluster-info dump`

![](../images/Pasted%20image%2020240404130658.png)

